<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Update password</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://kit.fontawesome.com/0806d4ce9d.js" crossorigin="anonymous"></script>
        <style>
            html, body {
              height: 100%;
            }
            body {
              display: flex;
              justify-content: center;
              align-items: center;
            }

          </style>
    </head>
    <body>
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-10 col-md-8 col-lg-4">
                    <div class="card" style="border-radius: 20px;">
                        <div class="card-body">
                            <div class="mt-4 mb-4 text-center">
                                <img class="mb-2" src="data:image/png;base64,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">
                                <h4>Update password</h4>
                                <p class="mx-4" style="color: grey;">This password will only be used to access your personal area. The functionality of any API keys will not be affected by this change</p>
                                <div class="container">
                                    <div class="mt-5">
                                        <div class="input-group">
                                            <input id="password" type="password" name="password" class="form-control" style="text-align: center;" aria-describedby="passwordHelp">
                                            <span class="input-group-text">
                                                <i id="password-icon" class="fa-regular fa-eye-slash" id="togglePassword" style="cursor: pointer" onclick="managePasswordVisibility()"></i>
                                            </span>
                                        </div>
                                        
                                        <button type="button" class="btn btn-primary mt-3" style="width: 100%;" onclick="sendUpdatePasswordRequest();">Submit</button>
                                    </div>
                                    <div id="error-alert" class="alert alert-danger mt-4" hidden >
                                        Could not update password
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>

        function checkPassword(password) {
            if (password.length > 0) {
                return true
            }
            return false;
        }

        function sendUpdatePasswordRequest() {
            var newPassword = document.getElementById("password").value;
            var access_token = getToken();

            if (checkPassword(newPassword)) {
                fetch('/update-password', {
                    method: 'POST',
                    body: JSON.stringify({access_token: access_token, password: newPassword}),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                })
                .then(response => manageResponse(response.status));
            }
            else {
                document.getElementById("error-alert").hidden = false;
            }
        }

        function getToken() {
            var hash = window.location.hash.substr(1);

            var result = hash.split('&').reduce(function (res, item) {
                var parts = item.split('=');
                res[parts[0]] = parts[1];
                return res;
            }, {});
            return result["access_token"];
        }

        function manageResponse(status) {
            if (status === 404) {
                document.getElementById("error-alert").hidden = false;
            }
            else if (status === 200) {
                location.href = "/sign-in";
            }
        }

        function managePasswordVisibility() {
            const normalEyeClass = "fa-regular fa-eye"
            const slashEyeClass = "fa-regular fa-eye-slash"


            let passwordField = document.getElementById("password");
            let type = passwordField.getAttribute("type");
            let passwordIcon = document.getElementById("password-icon");
            
            if (type === "password") {
                passwordField.setAttribute("type", "text");
                passwordIcon.className = normalEyeClass;
            }
            else {
                passwordField.setAttribute("type", "password");
                passwordIcon.className = slashEyeClass;
            }
        }

    </script>
</html>